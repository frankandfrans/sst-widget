<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latest SST Image</title>
    <style>
        #satellite-widget {
            width: 100%;
            max-width: 600px;
            text-align: center;
            font-family: Arial, sans-serif;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 20px;
            border-radius: 5px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
        }
        img {
            width: 100%;
            height: auto;
            border-radius: 5px;
            display: none; /* Hide image initially until a valid one is found */
        }
        #debug-info {
            font-size: 14px;
            color: red;
            background: #f8f8f8;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div id="satellite-widget">
        <h3>Latest SST Image - Cape Hatteras</h3>
        <img id="satellite-image" src="" alt="Loading Latest Satellite Image...">
        <p id="image-url">Checking for latest available image...</p>
        <div id="debug-info">Loading debug info...</div>
    </div>

    <script>
        async function fetchLatestImage() {
            const directoryUrl = "https://marine.rutgers.edu/cool/regions/capehat/sst/noaa/2025/img/";

            try {
                let response = await fetch(directoryUrl);
                let text = await response.text();

                // Extract last image file link using regex
                let matches = text.match(/(\d{6}\.077\.\d{4}\.n00\.jpg)/g);
                
                if (matches && matches.length > 0) {
                    let latestImage = matches[matches.length - 1]; // Get the last image link
                    let imageUrl = directoryUrl + latestImage;

                    // Update image and display
                    let imgElement = document.getElementById("satellite-image");
                    imgElement.src = imageUrl;
                    imgElement.style.display = "block"; // Show image

                    document.getElementById("image-url").textContent = `Image URL: ${imageUrl}`;
                    document.getElementById("debug-info").innerHTML = `
                        <strong>Latest Available Image Found:</strong><br>
                        <a href="${imageUrl}" target="_blank">${imageUrl}</a>
                    `;
                } else {
                    throw new Error("No image found in directory listing.");
                }
            } catch (error) {
                document.getElementById("satellite-image").style.display = "none";
                document.getElementById("image-url").textContent = "SEA SURFACE TEMP IS CURRENTLY NOT AVAILABLE";
                document.getElementById("debug-info").innerHTML = `<strong>Error:</strong> ${error.message}`;
                console.error("Error fetching latest image:", error);
            }
        }

        // Run script after page load
        window.onload = fetchLatestImage;
    </script>
</body>
</html>






