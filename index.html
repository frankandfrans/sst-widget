import requests
from datetime import datetime, timedelta

# Get current UTC time and subtract 2.5 hours
adjusted_time = datetime.utcnow() - timedelta(hours=2, minutes=30)

# Extract date components
year = str(adjusted_time.year)[-2:]
month = f"{adjusted_time.month:02}"
day = f"{adjusted_time.day:02}"
yymmdd = f"{year}{month}{day}"

# Always set minutes to 30
minutes = "30"
hours = adjusted_time.hour

# Adjust for day rollover if needed
if hours < 0:
    hours = 23
    adjusted_time -= timedelta(days=1)
    yymmdd = f"{str(adjusted_time.year)[-2:]}{adjusted_time.month:02}{adjusted_time.day:02}"

# Try up to 5 previous hours if the URL does not exist
max_attempts = 5
attempts = 0
image_url = ""

while attempts < max_attempts:
    hhmm = f"{hours:02}{minutes}"
    image_url = f"https://marine.rutgers.edu/cool/regions/capehat/sst/noaa/2025/img/{yymmdd}.077.{hhmm}.n00.jpg"

    # Check if the URL is valid
    try:
        response = requests.head(image_url)
        if response.status_code == 200:
            break  # Found a valid URL
    except requests.RequestException:
        pass  # Ignore request errors and continue

    # If not found, subtract an hour and try again
    hours -= 1
    if hours < 0:
        hours = 23
        adjusted_time -= timedelta(days=1)
        yymmdd = f"{str(adjusted_time.year)[-2:]}{adjusted_time.month:02}{adjusted_time.day:02}"
    
    attempts += 1

# Output the final valid image URL
print(image_url)

           
   
